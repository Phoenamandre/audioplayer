var audioPlayer={mime:null,file:null,location:null,player:null,dir:null,onView:function(a,b){a=encodeURIComponent(a),audioPlayer.file=a,audioPlayer.dir=b.dir;var c=void 0!==$("#sharingToken").val()?$("#sharingToken").val():"",d=b.dir.substr(1);""!=d&&(d+="/"),audioPlayer.location=""!==c?OC.generateUrl("apps/audioplayer/getpublicaudiostream?token={token}&file={file}",{token:c,file:d+a},{escape:!1}):OC.generateUrl("apps/audioplayer/getaudiostream?file={file}",{file:d+a},{escape:!1}),audioPlayer.mime=b.$file.attr("data-mime"),b.$file.find(".thumbnail").html('<i class="ioc ioc-volume-up"  style="color:#fff;margin-left:5px; text-align:center;line-height:32px;text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;font-size: 24px;"></i>'),null==audioPlayer.player?soundManager.setup({url:OC.filePath("audioplayer","js","soundmanager2.swf"),onready:function(){audioPlayer.player=soundManager.createSound({id:b.$file.attr("data-id"),url:audioPlayer.location}),audioPlayer.player.play()},ontimeout:function(){}}):(audioPlayer.player.stop(),$("#filestable").find(".thumbnail i.ioc-volume-up").hide(),audioPlayer.player=null)}};$(document).ready(function(){if(OCA.Files&&OCA.Files.fileActions){var a=["audio/mpeg","audio/mp4","audio/m4b","audio/ogg","audio/wav","audio/flac"];if(null==audioPlayer.player&&soundManager.setup({url:OC.filePath("audioplayer","js","soundmanager2.swf"),onready:function(){audioPlayer.player=soundManager.createSound({});for(var b=soundManager.html5,c=0;c<a.length;c++)!0===b[a[c]]&&(OCA.Files.fileActions.registerAction({name:"audioplayer play",displayName:t("audioplayer","Play"),mime:a[c],permissions:OC.PERMISSION_READ,icon:function(){return OC.imagePath("core","actions/sound")},actionHandler:audioPlayer.onView}),OCA.Files.fileActions.register(a[c],"View",OC.PERMISSION_READ,"",audioPlayer.onView),OCA.Files.fileActions.setDefault(a[c],"View"))}}),$("#header").hasClass("share-file")){var b=void 0!==$("#sharingToken").val()?$("#sharingToken").val():"",c=$("#mimetype").val();if(-1!==a.indexOf(c)){OC.addStyle("audioplayer","360player"),OC.addStyle("audioplayer","360player-visualization"),setTimeout(function(){$(".publicpreview").css({"margin-top":"0px"})},2e3),$("#imgframe").css({"max-width":"250px"}),$("#imgframe").css({"margin-bottom":"0px"}),"true"!==$("#previewSupported").val()&&$("#imgframe").hide();var d=$("#filename").val();d=encodeURIComponent(d);var e=OC.generateUrl("apps/audioplayer/getpublicaudiostream?token={token}&file={file}",{token:b,file:d},{escape:!1}),f=$("<div/>").attr("id","sm2-container");$("#preview").before(f);var g=$("<div>").addClass("outer-audioplayer").css("clear","both"),h=$("<div>").addClass("ui360 ui360-vis"),i=$("<a/>").attr({href:e}).text($("#filename").val()).css("visibility","hidden");h.append(i),g.append(h),f.append(g),soundManager.setup({url:"./apps/audioplayer/js/"}),$("#imgframe").before($("<div/>").attr("id","id3")),url=OC.generateUrl("apps/audioplayer/getpublicaudioinfo{file}?token={token}",{file:d,token:b},{escape:!1}),$.ajax({type:"GET",url:url,success:function(a){if("success"==a.status){a.data;$("#content-wrapper").css({"padding-top":"0px"}),$("#id3").append("<div>&nbsp;</div>"),$("#id3").append($("<div/>").append($("<b/>").text(t("audioplayer","Title")+": ")).append($("<span/>").text(a.data.title))),$("#id3").append($("<div/>").append($("<b/>").text(t("audioplayer","Subtitle")+": ")).append($("<span/>").text(a.data.subtitle))),$("#id3").append($("<div/>").append($("<b/>").text(t("audioplayer","Artist")+": ")).append($("<span/>").text(a.data.artist))),$("#id3").append($("<div/>").append($("<b/>").text(t("audioplayer","Composer")+": ")).append($("<span/>").text(a.data.composer))),$("#id3").append($("<div/>").append($("<b/>").text(t("audioplayer","Album")+": ")).append($("<span/>").text(a.data.album))),$("#id3").append($("<div/>").append($("<b/>").text(t("audioplayer","Genre")+": ")).append($("<span/>").text(a.data.genre))),$("#id3").append($("<div/>").append($("<b/>").text(t("audioplayer","Year")+": ")).append($("<span/>").text(a.data.year))),$("#id3").append($("<div/>").append($("<b/>").text(t("audioplayer","Disc")+"-"+t("audioplayer","Track")+": ")).append($("<span/>").text(a.data.disc+"-"+a.data.number))),$("#id3").append($("<div/>").append($("<b/>").text(t("audioplayer","Length")+": ")).append($("<span/>").text(a.data.length))),$("#id3").append($("<div/>").append($("<b/>").text(t("audioplayer","Bitrate")+": ")).append($("<span/>").text(a.data.bitrate))),$("#id3").append($("<div/>").append($("<b/>").text(t("audioplayer","MIME type")+": ")).append($("<span/>").text(a.data.mimetype))),$("#imgframe").css({"padding-top":"20px"}),$("#imgframe").css({"padding-bottom":"0px"}),$(".publicpreview").css({"max-width":"0px !important"}),$(".directDownload").css({"padding-top":"20px"}),$(".directLink").css({"padding-top":"0px"})}}})}}}});